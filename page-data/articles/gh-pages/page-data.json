{"componentChunkName":"component---src-templates-articles-index-js","path":"/articles/gh-pages","result":{"data":{"markdownRemark":{"frontmatter":{"title":"Automate your GitHub Pages deployment using Actions","description":"GitHub provides a free public static webpage hosting using the GitHub servers. It also provides a free domain by the name of username.github.io. You can automate the deployment using GitHub Actions easily. In this article, we will learn how to deploy the site build by a static site generator named Gatsby.","tags":["github","web"],"date":"2020-12-19T00:00:00.000Z","image":{"id":"6abd6cc1-f54e-5eeb-a9e1-c42d61a61484","publicURL":"/static/0aa3636e1151cd5838685f04ab26c307/preview.png"}},"fields":{"slug":"gh-pages","postType":"articles"},"html":"<h2>GitHub Pages</h2>\n<p>GitHub Pages are public web pages hosted by <a href=\"https://github.com/\">GitHub</a>. It also provides a free domain <code class=\"language-text\">username.github.io</code>. For example, this site is hosted on <code class=\"language-text\">rahulsrma26.github.io</code> because my username is <code class=\"language-text\">rahulsrma26</code>. </p>\n<p>Steps to host using the free domain are:</p>\n<ol>\n<li>Create a repository named <code class=\"language-text\">username.github.io</code></li>\n<li>Put all the static web content including <code class=\"language-text\">index.html</code> in the <code class=\"language-text\">master</code> branch</li>\n</ol>\n<p>If you face any difficulty following that then you can visit the official <a href=\"https://pages.github.com/\">GitHub pages</a> site or <a href=\"https://guides.github.com/features/pages/\">official guide</a>.</p>\n<p>Why do I choose a static site? Find it <a href=\"/articles/static-site\">here</a>.</p>\n<hr>\n<h2>GitHub Actions</h2>\n<p><a href=\"https://github.com/features/actions\">Github Actions</a> is a feature provided by GitHub to automate workflow. A user can specify their workflow that can run on any GitHub event. It is a popular feature for CI/CD. A user can build, test, and deploy the code right from GitHub. More can be learned on Github <a href=\"https://github.com/features/actions\">Action's site</a>.</p>\n<p>To use actions you first need to create a directory</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> -p .github/workflows/</code></pre></div>\n<p>A workflow can be specified using a YAML file in this directory.</p>\n<hr>\n<h2>Build and Deploy</h2>\n<p>If we want to use a static site generator that generates static pages from code/script (like <a href=\"https://www.gatsbyjs.com/\">Gatsby</a>). Then we need to save our code elsewhere. We can either save our code in a separate repository or in a separate branch. Since it's easier to manage a single repository, we can create a <code class=\"language-text\">dev</code> branch for all the code as the <code class=\"language-text\">master</code> branch is reserved for the deployment. </p>\n<p>To create the workflow we can create <code class=\"language-text\">deploy.yml</code> file in the <code class=\"language-text\">.github/workflows/</code> directory.</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token comment\"># Name of the workflow</span>\n<span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> github pages deployment\n\n<span class=\"token comment\"># Controls when the action will run. Triggers the workflow on </span>\n<span class=\"token comment\"># push or pull request events but only for the dev branch</span>\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> dev <span class=\"token punctuation\">]</span>\n  <span class=\"token key atrule\">pull_request</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> dev <span class=\"token punctuation\">]</span>\n\n<span class=\"token comment\"># Specifies what to run on the trigger</span>\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">deploy</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># first we need to checkout the repo</span>\n    <span class=\"token comment\"># if dev brach is not the default branch</span>\n    <span class=\"token comment\"># then you can specify the branch with 'ref'</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v2\n    <span class=\"token comment\"># then setup nodejs on the machine</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/setup<span class=\"token punctuation\">-</span>node@v1\n      <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">node-version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'12'</span>\n    \n    <span class=\"token comment\"># then we need to install our static site generator</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> npm install <span class=\"token punctuation\">-</span>g gatsby<span class=\"token punctuation\">-</span>cli\n    <span class=\"token comment\"># doing clean install</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> npm ci\n    \n    <span class=\"token comment\"># Building the site (static web pages)</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Gatsby Build\n      <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> gatsby build\n\n    <span class=\"token comment\"># Copy all files from the build folder to the master branch</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Deploy\n      <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> peaceiris/actions<span class=\"token punctuation\">-</span>gh<span class=\"token punctuation\">-</span>pages@v3\n      <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">github_token</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.GITHUB_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token key atrule\">publish_dir</span><span class=\"token punctuation\">:</span> ./public\n        <span class=\"token key atrule\">publish_branch</span><span class=\"token punctuation\">:</span> master  <span class=\"token comment\"># deploying branch</span></code></pre></div>\n<p>This will build and update your site whenever you push anything in the <code class=\"language-text\">dev</code> branch. If you want to restrict the deployment trigger on some specific files like <code class=\"language-text\">version.txt</code> or something like that, then you can modify the on push option.</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">paths</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token string\">'**version.txt'</span></code></pre></div>\n<p>This can be helpful in deploying a package to the hosting server. Like building and uploading a python package to a PyPI server, whenever there is a version update. I hope this article sheds some light on the capabilities of actions.</p>"}},"pageContext":{"id":"5c404140-7685-531d-9a99-25ab36fd5fbf"}},"staticQueryHashes":["1271460761","2127526068","3159585216","805030655"]}
{"componentChunkName":"component---src-templates-articles-index-js","path":"/articles/representing-matrix-in-cpp","result":{"data":{"markdownRemark":{"frontmatter":{"title":"Representing Matrix in C++","description":"Usually, we access elements of a 2D array, that is saved in a continuous memory like array[row*N+column]. Which is not as readable as array[row][column]. But a vector of vector has performance issues. This article shows an object-oriented way of representing a matrix as a C++ class without losing performance.","tags":["C++","matrix"],"date":"2017-11-11T00:00:00.000Z"},"fields":{"slug":"representing-matrix-in-cpp","postType":"articles"},"html":"<h2>Table of content</h2>\n<ul>\n<li><a href=\"#the-problem\">The Problem</a></li>\n<li><a href=\"#matrix-class\">Matrix Class</a></li>\n<li><a href=\"#conclusion\">Conclusion</a></li>\n</ul>\n<hr>\n<h1 id=\"the-problem\">The Problem</h1>\n<p>Most people, who has to deal with the matrices in C++, would be familiar with this problem.</p>\n<p>I'm listing two of the most popular ways for representing matrix. One excels in readability while others in performance.</p>\n<ul>\n<li>\n<p>First way is to use vector of vector.</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\">vector<span class=\"token operator\">&lt;</span>vector<span class=\"token operator\">&lt;</span><span class=\"token keyword\">int</span><span class=\"token operator\">>></span> <span class=\"token function\">matrix</span><span class=\"token punctuation\">(</span>rows<span class=\"token punctuation\">,</span> vector<span class=\"token operator\">&lt;</span><span class=\"token keyword\">int</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span>cols<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// do stuff</span>\n<span class=\"token comment\">// access like matrix[y][x]</span>\n<span class=\"token comment\">// no need to free. RAII rocks.</span></code></pre></div>\n<p>This is similar to using double pointer in C for dynamic 2D array.</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">int</span> <span class=\"token operator\">*</span><span class=\"token operator\">*</span>matrix <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token keyword\">int</span><span class=\"token operator\">*</span><span class=\"token punctuation\">[</span>rows<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> rows<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n    matrix<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">[</span>cols<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// do stuff</span>\n<span class=\"token comment\">// access like matrix[y][x]</span>\n<span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> rows<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">delete</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> matrix<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">delete</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> matrix<span class=\"token punctuation\">;</span></code></pre></div>\n<p>It's basically an array of arrays. Every element of the outer array points to another array of integers. That's why you can reference it two times. But, since every array is separately allocated, to access the array we must have to go to the elements of the outer array first and then inner ones. Also, there will be no guarantee that every row will be adjacent to each other in memory. They can be scattered across the heap.</p>\n</li>\n<li>\n<p>Second way is to use C style array.</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">int</span><span class=\"token operator\">*</span> matrix <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">[</span>rows<span class=\"token operator\">*</span>cols<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// do stuff</span>\n<span class=\"token comment\">// access like matrix[y*cols+x]</span>\n<span class=\"token keyword\">delete</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> matrix<span class=\"token punctuation\">;</span></code></pre></div>\n<p>This will make a solid continuous chunk of memory in heap. So, it'll have a better access time and pattern.</p>\n</li>\n</ul>\n<h2>Performance</h2>\n<p>C style array access should perform better than vector style access. As vector style has to refer two times to access an element, the address of matrix (outer array) can be saved in the register but elements have to come from memory (or cache). The other problem is that at the end of a row next row could be anywhere, and the pre-fetcher can not predict the next fetch.</p>\n<p>It's hard to measure general performance since the use case varies a lot. But to get some idea I'm considering two types of algorithms with square and rectangular matrices. All the results are compiler on GCC 7.2 with c++14 and -O3 flags on linux x86 machine.\nFor simplicity's sake, we have a fixed number of rows and columns but it can be easily changed to general inputs.</p>\n<h2>Sum of all elements</h2>\n<p>Let us take an example of calculating the sum of all the elements in a matrix. Here are our two popular approaches:</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token comment\">// Vector style code for a square matrix</span>\n<span class=\"token comment\">// Similar thing can be achieved in C by int**</span>\n<span class=\"token keyword\">int</span> <span class=\"token function\">Vector_sum</span><span class=\"token punctuation\">(</span>vector<span class=\"token operator\">&lt;</span>vector<span class=\"token operator\">&lt;</span><span class=\"token keyword\">int</span><span class=\"token operator\">>></span><span class=\"token operator\">&amp;</span> matrix<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> N<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">int</span> sum <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> N<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> j <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> j <span class=\"token operator\">&lt;</span> N<span class=\"token punctuation\">;</span> j<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n            sum <span class=\"token operator\">+=</span> matrix<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> sum<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token comment\">// C style code for a square matrix</span>\n<span class=\"token keyword\">int</span> <span class=\"token function\">C_style_sum</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token operator\">*</span> matrix<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> N<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">int</span> sum <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> N<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> j <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> j <span class=\"token operator\">&lt;</span> N<span class=\"token punctuation\">;</span> j<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n            sum <span class=\"token operator\">+=</span> matrix<span class=\"token punctuation\">[</span>i <span class=\"token operator\">*</span> N <span class=\"token operator\">+</span> j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> sum<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Results for a square matrix of size 512*512</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 893px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAABgUlEQVQoz42SaUsCQRjH9+sFveqi6NLqTfVZgig6CErI3makZKBkB1F47FpYq2vr7ZrHeuy646572TNrUmRQwx+Gmef5P795ZoYQRLFnmvcCv1lMHZQy+5Z2ubSjnGtrGoRg9IaGtW0SHUWBxVE5O/LyMB0PT8ZDU/HQGB20J6m62oWQLkpquqhmuS9liqaMXQSSZZhOqoUJOrTMRG0MZWeo+QS5zj43LDOkSqc+5L5C5wO5fDrfxGZRknpm77iSxzSGWmDIRYacTURW2ad6F5dXc5zkCaDLW+QdyHOt15vQDKFY5Z3VX8yf5FxJApr3Bl0M5A7o9RYmSwj9TXYPmXmL3O/ZWS2M08ElhgKnjSHnEpG1/5A7CjY7KrnR10cAzmDhO19JRnmL3IULc/kRtN2XO4DO/NAzNqvwmIZx16xt5N/2uNRWPrlTYLeL7OF7tq2pkKHVGnI4JlM0CsdQJCaTNCw1oY2P/fP1db3/K1TUEQWh1WqJbbEf0gxDN4zvyR+I3AGVoXspJgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"sum benchmark\"\n        title=\"sum benchmark\"\n        src=\"/static/b9bcb109dd8013478adb087307feab45/6c745/sum_square_1.png\"\n        srcset=\"/static/b9bcb109dd8013478adb087307feab45/6f3f2/sum_square_1.png 256w,\n/static/b9bcb109dd8013478adb087307feab45/01e7c/sum_square_1.png 512w,\n/static/b9bcb109dd8013478adb087307feab45/6c745/sum_square_1.png 893w\"\n        sizes=\"(max-width: 893px) 100vw, 893px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\nSee this benchmark on <a href=\"http://quick-bench.com/GXUG06sZDLCrGsOogF5wmd2DOFU\" target=\"_blank\">quick-bench</a></p>\n<p>Results for a rectangular matrix of size 1024*256</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 893px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAABcElEQVQoz52SS0/CQBDH+wG9qPHgG9GDGr+KF43xZEzEswqKFwSNF4N9KGmstJYILQ8pj/LY7faxLe5SUCMHEyf/ZLM788vMzgzT6/UC3zc9T0NW2UahdBtVbeT5fjC0wYSF70wfQnI5NfS518d15WlNEaKKsCLzO4Vc23WIC0ML1wz80fhWzQgcl7iYHgDkOKlr01I2IgvLMk/IhTy3qT63HJu43GIFXNzA5C28Giuexi2Twn0CBxSekbJrMs25KvOLeW7rCy5VQCINr+9gcqxEBjdN8hkGWhaJiBn6JByW7ZaqID4Btzo0M0RoCGv/gQFpWDCI1bVZKRuVBUJGZH4pz22rub/LDrt9XC9NvTyQhPNULOn8hiI0HVqU814GZyl4mRkpkYHnqVHDXM8b+P692djV3g4rhT1NOdDV/bJ6VCsCj84DN9oWKyJBgqwIORHxEmJFr9unmX9PH+NwK1zL6naokS0KXWRnsO//DP4EL4YFXPMEXnkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"sum benchmark\"\n        title=\"sum benchmark\"\n        src=\"/static/b12e7271f4f8eb7f12a4c25eeb040bb3/6c745/sum_rectangle_1.png\"\n        srcset=\"/static/b12e7271f4f8eb7f12a4c25eeb040bb3/6f3f2/sum_rectangle_1.png 256w,\n/static/b12e7271f4f8eb7f12a4c25eeb040bb3/01e7c/sum_rectangle_1.png 512w,\n/static/b12e7271f4f8eb7f12a4c25eeb040bb3/6c745/sum_rectangle_1.png 893w\"\n        sizes=\"(max-width: 893px) 100vw, 893px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\nSee this benchmark on <a href=\"http://quick-bench.com/ekNZpPxwiw4wYtqOV51vPF8CXUo\" target=\"_blank\">quick-bench</a></p>\n<p>As you can see the difference is not much. I can live with that for most of the programs. However, transpose yields a completely different story.</p>\n<h2>Transpose of all elements</h2>\n<p>Let us also take an example of transposing a matrix. Which will have a completely different access pattern then sum. Here are our two popular approaches:</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token comment\">// Vector style code for a square matrix</span>\n<span class=\"token comment\">// Similar thing can be achieved in C by int**</span>\n<span class=\"token keyword\">using</span> <span class=\"token keyword\">namespace</span> Matrix <span class=\"token operator\">=</span> vector<span class=\"token operator\">&lt;</span>vector<span class=\"token operator\">&lt;</span><span class=\"token keyword\">int</span><span class=\"token operator\">>></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">int</span> <span class=\"token function\">Vector_transpose</span><span class=\"token punctuation\">(</span>Matrix<span class=\"token operator\">&amp;</span> matrix1<span class=\"token punctuation\">,</span> Matrix<span class=\"token operator\">&amp;</span> matrix2<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> N<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">int</span> sum <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> N<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> j <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> j <span class=\"token operator\">&lt;</span> N<span class=\"token punctuation\">;</span> j<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n            matrix<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> matrix<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> sum<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token comment\">// C style code for a square matrix</span>\n<span class=\"token keyword\">int</span> <span class=\"token function\">C_style_transpose</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token operator\">*</span> matrix1<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span><span class=\"token operator\">*</span> matrix2<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> N<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">int</span> sum <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> N<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> j <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> j <span class=\"token operator\">&lt;</span> N<span class=\"token punctuation\">;</span> j<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n            matrix2<span class=\"token punctuation\">[</span>i <span class=\"token operator\">*</span> N <span class=\"token operator\">+</span> j<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> matrix1<span class=\"token punctuation\">[</span>j <span class=\"token operator\">*</span> N <span class=\"token operator\">+</span> i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> sum<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Results for a square matrix of size 512*512</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 893px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAABSklEQVQoz4WRa0sCQRiF9/8FfVLLKDPqx/TJAoXoNxRkZAgl+LHaW+Btd1w0WtdYyevuzK6rc2l2tYJKOxwYhsPDe94ZAUKIMWYrRCllqyUg32eUKe742DROrdZJ5IzVynbb/Vmwnheg5/HjZmBv1B62NSmhiVuaGNOednXZnIYR+QemrDi045p4ANR9oKSBkgLyUfO5E8GYEPqnKY1qMw73Yg0xDdQUUDi/B+TDT3jdZOR76+H5xA0qIKgZ364AAsNI8KbTBRxv/KrtIx7NLNu9LMKru6Xz9+5FEb8Po52jyYWhvVl/3NGlpC4ndSmhi7zCqwd5FHR76LqECuWlb8swX8L9UQhjvhKhqjPKmMaZ1c6azVzHyFmt87eXwSwshUcTX6r6Sh1JVW5fbfAr34W/hPDzG+eYERK2Rd5kHMpxnEWCKZlH0Zc+AOeYFryULwWEAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"sum benchmark\"\n        title=\"sum benchmark\"\n        src=\"/static/cd28d8970decdd5b96223887f704a68d/6c745/transpose_square_1.png\"\n        srcset=\"/static/cd28d8970decdd5b96223887f704a68d/6f3f2/transpose_square_1.png 256w,\n/static/cd28d8970decdd5b96223887f704a68d/01e7c/transpose_square_1.png 512w,\n/static/cd28d8970decdd5b96223887f704a68d/6c745/transpose_square_1.png 893w\"\n        sizes=\"(max-width: 893px) 100vw, 893px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\nSee this benchmark on <a href=\"http://quick-bench.com/0DVlD6PAcBQvMmfnjLlJpcSHcls\" target=\"_blank\">quick-bench</a></p>\n<p>Results for a rectangular matrix of size 1024*256</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 893px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAABU0lEQVQoz32SW0sCQRzF9+v10kNooJDZ7ev0UEIZfYQiKyEEo7eovUmY7s6aec+VUtvdmV3dnUuzqxVEejgwDIcf//MfRoAQYozZAlFK2WIJyPMYZU/IOujVT/qNbOTjfuPUbA6DacizhbwAXZcfV8P+yvP9uibFNDGuiWvaY1KX25MwInQ5TNnNyOTkNiilgboF1E2g7BmlTgRjwvH/FdVmHB7EqiInU0Dh5AaQd77hZZOR5y6HsQN9o+m/tH5tNIkbjhTcyWQGx6virHAaKCkg73LYQzzyu6ZzXoC54tyXt85ZAb+Pop2jyfmRuVp5SOpSQpcTurSui7xCy4U8mvYGKFdE13coPze8KOKPcQhjvhKhqj3eb9eOuq+HbSPTqWW69exbY+iHpfDY8qSyp1SQVOb21Cq/BpbDX0L4+w0CzAgJ2yLX+gxl2/YswZQEUfSjLy/wF5rLXd4kAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"sum benchmark\"\n        title=\"sum benchmark\"\n        src=\"/static/93707364745517536b0eb5909425b62e/6c745/transpose_rectangle_1.png\"\n        srcset=\"/static/93707364745517536b0eb5909425b62e/6f3f2/transpose_rectangle_1.png 256w,\n/static/93707364745517536b0eb5909425b62e/01e7c/transpose_rectangle_1.png 512w,\n/static/93707364745517536b0eb5909425b62e/6c745/transpose_rectangle_1.png 893w\"\n        sizes=\"(max-width: 893px) 100vw, 893px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\nSee this benchmark on <a href=\"http://quick-bench.com/IyZq2RwP_RtZJpC4B8iwTSTSRwI\" target=\"_blank\">quick-bench</a></p>\n<hr>\n<h1 id=\"matrix-class\">Matrix Class</h1>\n<p>We can write a custom template class that will allow us to access elements like vector. To achieve we need to overload the brackets operator.</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token comment\">// e.g. a matrix of 5 rows and 3 cols</span>\n<span class=\"token comment\">// matrix&lt;int, 5, 3> x;</span>\n<span class=\"token comment\">// can be accessed like x[row][col]</span>\n\n<span class=\"token keyword\">template</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">typename</span> <span class=\"token class-name\">T</span><span class=\"token punctuation\">,</span> size_t R<span class=\"token punctuation\">,</span> size_t C<span class=\"token operator\">></span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">matrix</span> <span class=\"token punctuation\">{</span>\n    T<span class=\"token operator\">*</span> data<span class=\"token punctuation\">;</span> <span class=\"token comment\">// can be changed to unique_ptr in C++1z</span>\n<span class=\"token keyword\">public</span><span class=\"token operator\">:</span>\n    <span class=\"token function\">matrix</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token function\">data</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> T<span class=\"token punctuation\">[</span>R<span class=\"token operator\">*</span>C<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n    <span class=\"token operator\">~</span><span class=\"token function\">matrix</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span> <span class=\"token keyword\">delete</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> data<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">inline</span> T<span class=\"token operator\">*</span> <span class=\"token keyword\">operator</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> row<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token operator\">&amp;</span>data<span class=\"token punctuation\">[</span>row <span class=\"token operator\">*</span> C<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">inline</span> <span class=\"token keyword\">const</span> T<span class=\"token operator\">*</span> <span class=\"token keyword\">operator</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> row<span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token operator\">&amp;</span>data<span class=\"token punctuation\">[</span>row <span class=\"token operator\">*</span> C<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Almost all the compilers today can optimize away the referencing and dereferencing of the same array. The assembly code generated by it is virtually the same as the C style version.</p>\n<p>So, how well it performs.</p>\n<h2>Sum of all elements</h2>\n<p>Results for a square matrix of size 512*512</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 893px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAABo0lEQVQoz32SW0sbQRiG8+MKIq2xlqIXTZCWgtK/0At7rUSo4JV/QAihaZu2NCbUFIqnxCQGs0lWrDa1yZ6yu3PY3ZnZ2e1sPEVFZ2Bg3m+eeWC+iSEAXUY/G72MfpbV/62rf2UHhWEYiDkyOOdBcJ0EwxHzCQWUJFrlycPtaWn3UeNXzuiJMkE+szkDXKzc5SJh+IyYTWp1qCkx+EckMep5kNE3R/XZduW1XH0u7W6YqijoP7HyEapfkZKF4MARCWgs64UJo5TQi5N29V0EuxjbxJuTa0L+srM/1dz5PlAiuISVD1DNISUDQf0cTumFJ0bphV6M29WFCOaMAUpvwKZyYc5C9QsSV1zCd8zEce8134ZTI/DQzDwiHmxeriVb5Ved/WfNnfxD5rhRSurFpxdmRiJYOKelvUS78vhw69ugLwraD9TPQPUT6qcBqEWwfbCo5ceMzRktP25V3kZw4PuYkrXe75WuvNqVU125Bs2Qh0DyrLIzKGNrz8EnrmgxPs0J3mq8txtL6Dgtklg42njfv9phF9nQ0gYaRHD0t7DrI+F/ws0D19vv0PIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"sum benchmark\"\n        title=\"sum benchmark\"\n        src=\"/static/60488233b96207802905fdd8f618b30d/6c745/sum_square_2.png\"\n        srcset=\"/static/60488233b96207802905fdd8f618b30d/6f3f2/sum_square_2.png 256w,\n/static/60488233b96207802905fdd8f618b30d/01e7c/sum_square_2.png 512w,\n/static/60488233b96207802905fdd8f618b30d/6c745/sum_square_2.png 893w\"\n        sizes=\"(max-width: 893px) 100vw, 893px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\nSee this benchmark on <a href=\"http://quick-bench.com/UODm6ylUQGqDCGbdxMIUvpqHrcA\" target=\"_blank\">quick-bench</a></p>\n<p>Results for a rectangular matrix of size 1024*256\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 893px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAABn0lEQVQoz6WRSUsjQRTH8+1ExBVURqK4wYgXT54GBi9e3EDBkx/BFR1Ro06iCCpZTAwxJo0bAemkl3R3Ld3Vqer2dauZGZibf96h6v/ej1f1XgQhxDl3BLfDoII3hPBAvud/BpxFaPqf8kJFHEqRy6YfC5NSbuohP1zKxOsKpDkXHvc+QgScaBDhGIKZghnCxVATsQmxXDZevvlWTA6V0h2Fq0NdhoR+TdUY1n4T9Qjjog0OKqxo8V79YkxL9Fm52QB2CDUZ+y5lo/epkXKm++76SK9CQkkQeQtV97C8gawsBce6XVCP27TEgHrSbmZ+BrDrOND5H7gewOo5qe6g2j6ubiMrF8L5JcC0s6h62mnezHwZZtQ2mTMhZQfvU6PlTE/z2f+HO7SzQfW06wOGaUNn6NlXTEZL6bbC5UE4sFocy5uotovldev9z+btnBJr0RL9SqzVSP8IYI9z4rK116eVirRakRYrUhbVfeFbRcdIUT2FjSQlzzasirz8At7IL5v5efy4Dk6kuXcflsl580ZsbFiGoisII/8vNf6U+G+TLwddTbC6AAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"sum benchmark\"\n        title=\"sum benchmark\"\n        src=\"/static/09fa3646b22d4b701fb283c5b5935d30/6c745/sum_rectangle_2.png\"\n        srcset=\"/static/09fa3646b22d4b701fb283c5b5935d30/6f3f2/sum_rectangle_2.png 256w,\n/static/09fa3646b22d4b701fb283c5b5935d30/01e7c/sum_rectangle_2.png 512w,\n/static/09fa3646b22d4b701fb283c5b5935d30/6c745/sum_rectangle_2.png 893w\"\n        sizes=\"(max-width: 893px) 100vw, 893px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\nSee this benchmark on <a href=\"http://quick-bench.com/-rGgWT2v0CZsUNbOtoTOCs9ybiE\" target=\"_blank\">quick-bench</a></p>\n<p>Separate code can be found <a href=\"/downloads/1c40e0eeeab98e6719597664b4b90d0e/sum.cpp\" target=\"_blank\">here</a></p>\n<h2>Transpose of all elements</h2>\n<p>Results for a square matrix of size 512*512</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 893px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAABYElEQVQoz5WSS0vDQBDH893Eg4og1YMVvOhnUA96FyyIFf0GKr5ARRCLehCp2oaK2DapTW21G7Bp0prH5rlpdLYR2wqiDsuwO7M//jOzy2CMfd9/77UgCH6NgDGObXs+2ZBQDJVWxfJiVbhSFUi0em//CLuEzFRyI/nbiQI7mLvelKr/gB3PW3jmogV2ung3xqV3ZBESfgvwjrXo8dsKGNdxQBngcZ6dKt6NcqkQ/rMyhfkOXKew9UrMErEq1LsSgYjXuLdeDmzxxK4eOlKSwp7rhspRPiz7E24kzdqeLh0Z4NU0hoiRW5FP+5SLiJzoV9nZUJmWPVfJR/jU5GNmOH+zJaE2bNX29foxBq+xJoW5NeVsoHkZVc6HtMw8haEbgLclFBeFdSQsIyHZfipDcFTWarJYTdv4yYaOTZRQH5besnE1GzPKuxBhOpOAHSFfwzBtrBma3JR1rHcPiXR9qA98Ch8/GEdsxAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"sum benchmark\"\n        title=\"sum benchmark\"\n        src=\"/static/9d157c4dc0f978aba05905ff8065b36f/6c745/transpose_square_2.png\"\n        srcset=\"/static/9d157c4dc0f978aba05905ff8065b36f/6f3f2/transpose_square_2.png 256w,\n/static/9d157c4dc0f978aba05905ff8065b36f/01e7c/transpose_square_2.png 512w,\n/static/9d157c4dc0f978aba05905ff8065b36f/6c745/transpose_square_2.png 893w\"\n        sizes=\"(max-width: 893px) 100vw, 893px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\nSee this benchmark on <a href=\"http://quick-bench.com/VxtU_lR77Fjtm-vo9Vs8CmMDQl4\" target=\"_blank\">quick-bench</a></p>\n<p>Results for a rectangular matrix of size 1024*256</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 893px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAABYUlEQVQoz5WSy07CQBSG+3hqNCZeEjBxoz6CiQvxBTTR4CXxAYxRdGNceVmwQYQKJkJbpAjEAlJaYNpOr1PQMxAFYox6Ficz58w3/5w/w2CMfd9/H41ut/trBYJxbNvzyalS2a2+HNZKO5VCXG9+P/0j7BKyWsxOc/fBHDuevTuSX6HR+SPseN5GWVjIPazkH+d5NqJUoeF3AB9EZ3TbD8Z1HFAOlfmAwC7l07N8Akb4jzKFhQHcoLD1RswCsUo0uzJ11DdrpJ0lKEfaHDHKFPZct68cFNjlfHruE27GzPqZLl8YkFHShIrB76s3E81oUL2d1FKhvjJ99lqJmxESi8+pKS5+LEs92Kqf641LDFljezC3p16PtaIBuEJLrVMYpgH4RJbCFfFAErclMYZUelR0EGu1WIySNi7YMLEpXaGnzXYmjDJbRjECFWbgBKwI+TLDtLFmaEpL0bE+bBIZ+lAf8Iggh4U/PioAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"sum benchmark\"\n        title=\"sum benchmark\"\n        src=\"/static/11622b1c25f28dbb060b3acedb045624/6c745/transpose_rectangle_2.png\"\n        srcset=\"/static/11622b1c25f28dbb060b3acedb045624/6f3f2/transpose_rectangle_2.png 256w,\n/static/11622b1c25f28dbb060b3acedb045624/01e7c/transpose_rectangle_2.png 512w,\n/static/11622b1c25f28dbb060b3acedb045624/6c745/transpose_rectangle_2.png 893w\"\n        sizes=\"(max-width: 893px) 100vw, 893px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\nSee this benchmark on <a href=\"http://quick-bench.com/PXQl8uW3Dk1R_pBelXFlFCMRxEY\" target=\"_blank\">quick-bench</a></p>\n<p>Separate code can be found <a href=\"/downloads/58f4d1b0afc827ce8bdb30a5b5038160/transpose.cpp\" target=\"_blank\">here</a></p>"}},"pageContext":{"id":"a70e0837-62f5-519e-9e5a-6ca6bc0b4027"}},"staticQueryHashes":["1271460761","2127526068","3159585216","805030655"]}